{"version":3,"file":"dialog.cjs.production.min.js","sources":["../src/index.tsx"],"sourcesContent":["/* eslint-disable jsx-a11y/no-static-element-interactions */\n\n/**\n * Welcome to @reach/dialog!\n *\n * An accessible dialog or \"modal\" window.\n *\n * @see Docs     https://reacttraining.com/reach-ui/dialog\n * @see Source   https://github.com/reach/reach-ui/tree/master/packages/dialog\n * @see WAI-ARIA https://www.w3.org/TR/wai-aria-practices-1.1/#dialog_modal\n */\n\nimport React, { forwardRef, useCallback, useEffect, useRef } from \"react\";\nimport Portal from \"@reach/portal\";\nimport {\n  checkStyles,\n  getOwnerDocument,\n  isString,\n  noop,\n  useForkedRef,\n  wrapEvent,\n} from \"@reach/utils\";\nimport FocusLock from \"react-focus-lock\";\nimport { RemoveScroll } from \"react-remove-scroll\";\nimport PropTypes from \"prop-types\";\n\nconst overlayPropTypes = {\n  initialFocusRef: () => null,\n  allowPinchZoom: PropTypes.bool,\n  onDismiss: PropTypes.func,\n};\n\n////////////////////////////////////////////////////////////////////////////////\n\n/**\n * DialogOverlay\n *\n * Low-level component if you need more control over the styles or rendering of\n * the dialog overlay.\n *\n * Note: You must render a `DialogContent` inside.\n *\n * @see Docs https://reacttraining.com/reach-ui/dialog#dialogoverlay\n */\nexport const DialogOverlay = forwardRef<HTMLDivElement, DialogProps>(\n  function DialogOverlay({ isOpen = true, ...props }, forwardedRef) {\n    useEffect(() => checkStyles(\"dialog\"), []);\n    return isOpen ? (\n      <Portal data-reach-dialog-wrapper=\"\">\n        <DialogInner ref={forwardedRef} {...props} />\n      </Portal>\n    ) : null;\n  }\n);\n\nif (__DEV__) {\n  DialogOverlay.displayName = \"DialogOverlay\";\n  DialogOverlay.propTypes = {\n    ...overlayPropTypes,\n    isOpen: PropTypes.bool,\n  };\n}\n\n////////////////////////////////////////////////////////////////////////////////\n\n/**\n * DialogInner\n */\nconst DialogInner = forwardRef<HTMLDivElement, DialogProps>(\n  function DialogInner(\n    {\n      allowPinchZoom,\n      initialFocusRef,\n      onClick,\n      onDismiss = noop,\n      onMouseDown,\n      onKeyDown,\n      ...props\n    },\n    forwardedRef\n  ) {\n    const mouseDownTarget = useRef<EventTarget | null>(null);\n    const overlayNode = useRef<HTMLDivElement | null>(null);\n    const ref = useForkedRef(overlayNode, forwardedRef);\n\n    const activateFocusLock = useCallback(() => {\n      if (initialFocusRef && initialFocusRef.current) {\n        initialFocusRef.current.focus();\n      }\n    }, [initialFocusRef]);\n\n    function handleClick(event: React.MouseEvent) {\n      if (mouseDownTarget.current === event.target) {\n        event.stopPropagation();\n        onDismiss(event);\n      }\n    }\n\n    function handleKeyDown(event: React.KeyboardEvent) {\n      if (event.key === \"Escape\") {\n        event.stopPropagation();\n        onDismiss(event);\n      }\n    }\n\n    function handleMouseDown(event: React.MouseEvent) {\n      mouseDownTarget.current = event.target;\n    }\n\n    useEffect(\n      () =>\n        overlayNode.current ? createAriaHider(overlayNode.current) : void null,\n      []\n    );\n\n    return (\n      <FocusLock autoFocus returnFocus onActivation={activateFocusLock}>\n        <RemoveScroll allowPinchZoom={allowPinchZoom}>\n          <div\n            {...props}\n            ref={ref}\n            data-reach-dialog-overlay=\"\"\n            /*\n             * We can ignore the `no-static-element-interactions` warning here\n             * because our overlay is only designed to capture any outside\n             * clicks, not to serve as a clickable element itself.\n             */\n            onClick={wrapEvent(onClick, handleClick)}\n            onKeyDown={wrapEvent(onKeyDown, handleKeyDown)}\n            onMouseDown={wrapEvent(onMouseDown, handleMouseDown)}\n          />\n        </RemoveScroll>\n      </FocusLock>\n    );\n  }\n);\n\nif (__DEV__) {\n  DialogOverlay.displayName = \"DialogOverlay\";\n  DialogOverlay.propTypes = {\n    ...overlayPropTypes,\n  };\n}\n\n////////////////////////////////////////////////////////////////////////////////\n\n/**\n * DialogContent\n *\n * Low-level component if you need more control over the styles or rendering of\n * the dialog content.\n *\n * Note: Must be a child of `DialogOverlay`.\n *\n * Note: You only need to use this when you are also styling `DialogOverlay`,\n * otherwise you can use the high-level `Dialog` component and pass the props\n * to it. Any props passed to `Dialog` component (besides `isOpen` and\n * `onDismiss`) will be spread onto `DialogContent`.\n *\n * @see Docs https://reacttraining.com/reach-ui/dialog#dialogcontent\n */\nexport const DialogContent = forwardRef<HTMLDivElement, DialogContentProps>(\n  function DialogContent({ onClick, onKeyDown, ...props }, forwardedRef) {\n    return (\n      <div\n        aria-modal=\"true\"\n        role=\"dialog\"\n        tabIndex={-1}\n        {...props}\n        ref={forwardedRef}\n        data-reach-dialog-content=\"\"\n        onClick={wrapEvent(onClick, event => {\n          event.stopPropagation();\n        })}\n      />\n    );\n  }\n);\n\n/**\n * @see Docs https://reacttraining.com/reach-ui/dialog#dialogcontent-props\n */\nexport type DialogContentProps = {\n  /**\n   * Accepts any renderable content.\n   *\n   * @see Docs https://reacttraining.com/reach-ui/dialog#dialogcontent-children\n   */\n  children?: React.ReactNode;\n} & React.HTMLAttributes<HTMLDivElement>;\n\nif (__DEV__) {\n  DialogContent.displayName = \"DialogContent\";\n  DialogContent.propTypes = {\n    \"aria-label\": ariaLabelType,\n    \"aria-labelledby\": ariaLabelType,\n  };\n}\n\n////////////////////////////////////////////////////////////////////////////////\n\n/**\n * Dialog\n *\n * High-level component to render a modal dialog window over the top of the page\n * (or another dialog).\n *\n * @see Docs https://reacttraining.com/reach-ui/dialog#dialog\n */\nexport const Dialog = forwardRef<HTMLDivElement, DialogProps>(function Dialog(\n  { isOpen, onDismiss = noop, initialFocusRef, allowPinchZoom, ...props },\n  forwardedRef\n) {\n  return (\n    <DialogOverlay\n      initialFocusRef={initialFocusRef}\n      allowPinchZoom={allowPinchZoom}\n      isOpen={isOpen}\n      onDismiss={onDismiss}\n    >\n      <DialogContent ref={forwardedRef} {...props} />\n    </DialogOverlay>\n  );\n});\n\n/**\n * @see Docs https://reacttraining.com/reach-ui/dialog#dialog-props\n */\nexport type DialogProps = {\n  allowPinchZoom?: boolean;\n  /**\n   * Controls whether the dialog is open or not.\n   *\n   * @see Docs https://reacttraining.com/reach-ui/dialog#dialog-isopen\n   */\n  isOpen?: boolean;\n  /**\n   * This function is called whenever the user hits \"Escape\" or clicks outside\n   * the dialog. _It's important to close the dialog `onDismiss`_.\n   *\n   * The only time you shouldn't close the dialog on dismiss is when the dialog\n   * requires a choice and none of them are \"cancel\". For example, perhaps two\n   * records need to be merged and the user needs to pick the surviving record.\n   * Neither choice is less destructive than the other, so in these cases you\n   * may want to alert the user they need to a make a choice on dismiss instead\n   * of closing the dialog.\n   *\n   * @see Docs https://reacttraining.com/reach-ui/dialog#dialog-ondismiss\n   */\n  onDismiss?: (event?: React.SyntheticEvent) => void;\n  /**\n   * Accepts any renderable content.\n   *\n   * @see Docs https://reacttraining.com/reach-ui/dialog#dialog-children\n   */\n  children?: React.ReactNode;\n  /**\n   * By default the first focusable element will receive focus when the dialog\n   * opens but you can provide a ref to focus instead.\n   *\n   * @see Docs https://reacttraining.com/reach-ui/dialog#dialogoverlay-initialfocusref\n   */\n  initialFocusRef?: React.RefObject<any>;\n} & React.HTMLAttributes<HTMLDivElement>;\n\nif (__DEV__) {\n  Dialog.displayName = \"Dialog\";\n  Dialog.propTypes = {\n    isOpen: PropTypes.bool,\n    onDismiss: PropTypes.func,\n    \"aria-label\": ariaLabelType,\n    \"aria-labelledby\": ariaLabelType,\n  };\n}\n\nexport default Dialog;\n\n////////////////////////////////////////////////////////////////////////////////\nfunction createAriaHider(dialogNode: HTMLElement) {\n  let originalValues: any[] = [];\n  let rootNodes: HTMLElement[] = [];\n  let ownerDocument = getOwnerDocument(dialogNode) || document;\n\n  if (!dialogNode) {\n    if (__DEV__) {\n      console.warn(\n        \"A ref has not yet been attached to a dialog node when attempting to call `createAriaHider`.\"\n      );\n    }\n    return noop;\n  }\n\n  Array.prototype.forEach.call(\n    ownerDocument.querySelectorAll(\"body > *\"),\n    node => {\n      const portalNode = dialogNode.parentNode?.parentNode?.parentNode;\n      if (node === portalNode) {\n        return;\n      }\n      let attr = node.getAttribute(\"aria-hidden\");\n      let alreadyHidden = attr !== null && attr !== \"false\";\n      if (alreadyHidden) {\n        return;\n      }\n      originalValues.push(attr);\n      rootNodes.push(node);\n      node.setAttribute(\"aria-hidden\", \"true\");\n    }\n  );\n\n  return () => {\n    rootNodes.forEach((node, index) => {\n      let originalValue = originalValues[index];\n      if (originalValue === null) {\n        node.removeAttribute(\"aria-hidden\");\n      } else {\n        node.setAttribute(\"aria-hidden\", originalValue);\n      }\n    });\n  };\n}\n\nfunction ariaLabelType(\n  props: { [key: string]: any },\n  propName: string,\n  compName: string,\n  location: string,\n  propFullName: string\n) {\n  const details =\n    \"\\nSee https://www.w3.org/TR/wai-aria/#aria-label for details.\";\n  if (!props[\"aria-label\"] && !props[\"aria-labelledby\"]) {\n    return new Error(\n      `A <${compName}> must have either an \\`aria-label\\` or \\`aria-labelledby\\` prop.\n      ${details}`\n    );\n  }\n  if (props[\"aria-label\"] && props[\"aria-labelledby\"]) {\n    return new Error(\n      \"You provided both `aria-label` and `aria-labelledby` props to a <\" +\n        compName +\n        \">. If the a label for this component is visible on the screen, that label's component should be given a unique ID prop, and that ID should be passed as the `aria-labelledby` prop into <\" +\n        compName +\n        \">. If the label cannot be determined programmatically from the content of the element, an alternative label should be provided as the `aria-label` prop, which will be used as an `aria-label` on the HTML tag.\" +\n        details\n    );\n  } else if (props[propName] != null && !isString(props[propName])) {\n    return new Error(\n      `Invalid prop \\`${propName}\\` supplied to \\`${compName}\\`. Expected \\`string\\`, received \\`${\n        Array.isArray(propFullName) ? \"array\" : typeof propFullName\n      }\\`.`\n    );\n  }\n  return null;\n}\n"],"names":["DialogOverlay","forwardRef","forwardedRef","isOpen","props","useEffect","checkStyles","React","Portal","DialogInner","ref","allowPinchZoom","initialFocusRef","onClick","onDismiss","noop","onMouseDown","onKeyDown","mouseDownTarget","useRef","overlayNode","useForkedRef","activateFocusLock","useCallback","current","focus","originalValues","rootNodes","ownerDocument","getOwnerDocument","dialogNode","document","Array","prototype","forEach","call","querySelectorAll","node","parentNode","_dialogNode$parentNod","_dialogNode$parentNod2","attr","getAttribute","push","setAttribute","index","originalValue","removeAttribute","FocusLock","autoFocus","returnFocus","onActivation","RemoveScroll","wrapEvent","event","target","stopPropagation","key","DialogContent","role","tabIndex","Dialog"],"mappings":"gcA4CaA,EAAgBC,cAC3B,WAAoDC,WAA3BC,OAAAA,gBAAkBC,yBACzCC,aAAU,kBAAMC,cAAY,YAAW,IAChCH,EACLI,gBAACC,+BAAiC,IAChCD,gBAACE,iBAAYC,IAAKR,GAAkBE,KAEpC,QAiBFK,EAAcR,cAClB,WAUEC,OARES,IAAAA,eACAC,IAAAA,gBACAC,IAAAA,YACAC,UAAAA,aAAYC,SACZC,IAAAA,YACAC,IAAAA,UACGb,4FAICc,EAAkBC,SAA2B,MAC7CC,EAAcD,SAA8B,MAC5CT,EAAMW,eAAaD,EAAalB,GAEhCoB,EAAoBC,eAAY,WAChCX,GAAmBA,EAAgBY,SACrCZ,EAAgBY,QAAQC,UAEzB,CAACb,WAoBJP,aACE,kBACEe,EAAYI,SAwKdE,EAAwB,GACxBC,EAA2B,GAC3BC,EAAgBC,mBAHGC,EAvKqBV,EAAYI,UA0KJO,SAE/CD,GASLE,MAAMC,UAAUC,QAAQC,KACtBP,EAAcQ,iBAAiB,aAC/B,SAAAC,cAEMA,eADeP,EAAWQ,mCAAXC,EAAuBD,+BAAvBE,EAAmCF,iBAIlDG,EAAOJ,EAAKK,aAAa,eACA,OAATD,GAA0B,UAATA,IAIrCf,EAAeiB,KAAKF,GACpBd,EAAUgB,KAAKN,GACfA,EAAKO,aAAa,cAAe,aAI9B,WACLjB,EAAUO,SAAQ,SAACG,EAAMQ,OACnBC,EAAgBpB,EAAemB,GACb,OAAlBC,EACFT,EAAKU,gBAAgB,eAErBV,EAAKO,aAAa,cAAeE,QA3B9B/B,aAlL0D,EAuKrE,IAAyBe,EACnBJ,EACAC,EACAC,IAzKA,IAIArB,gBAACyC,GAAUC,aAAUC,eAAYC,aAAc7B,GAC7Cf,gBAAC6C,gBAAazC,eAAgBA,GAC5BJ,uCACMH,GACJM,IAAKA,8BACqB,GAM1BG,QAASwC,YAAUxC,YApCNyC,GACfpC,EAAgBM,UAAY8B,EAAMC,SACpCD,EAAME,kBACN1C,EAAUwC,OAkCNrC,UAAWoC,YAAUpC,YA9BNqC,GACH,WAAdA,EAAMG,MACRH,EAAME,kBACN1C,EAAUwC,OA4BNtC,YAAaqC,YAAUrC,YAxBNsC,GACvBpC,EAAgBM,QAAU8B,EAAMC,kBAuDzBG,EAAgBzD,cAC3B,WAAyDC,OAAhCW,IAAAA,QAAuBT,sCAE5CG,kDACa,OACXoD,KAAK,SACLC,UAAW,GACPxD,GACJM,IAAKR,8BACqB,GAC1BW,QAASwC,YAAUxC,GAAS,SAAAyC,GAC1BA,EAAME,2BAqCHK,EAAS5D,cAAwC,WAE5DC,OADEC,IAAAA,WAAQW,UAAAA,aAAYC,SAAMH,IAAAA,gBAAiBD,IAAAA,eAAmBP,wEAI9DG,gBAACP,GACCY,gBAAiBA,EACjBD,eAAgBA,EAChBR,OAAQA,EACRW,UAAWA,GAEXP,gBAACmD,iBAAchD,IAAKR,GAAkBE"}